<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="/static/css/email_challenge.css" rel="stylesheet">
<style>
    input[type=text] {
        width: 100%;
        padding: 12px 20px;
        margin: 10px 0;
        display: inline-block;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 16px;
    }

    input[type=checkbox] {
        padding: 0px 0px;
        margin: 10px 0;
        margin-right: 5px;
        display: inline-block;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }

    .btnCustom {
        width: 100%;
        background-color: #4CAF50;
        color: white;
        padding: 14px 20px;
        margin: 14px 0 10px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
    }

    .btnCustom:hover,
    .btnCustom:focus {
        background-color: #45a049;
    }

    .title {
        margin: 0;
        font-size: 40px;
        line-height: 40px;
        text-align: center;
    }

    .subtitle {
        margin-top: 10px;
        font-size: 16px;
        text-align: center;
    }
</style>
</head>

<body>

    <div class="main">
        <div class="container">
            <p class="title">Welcome to NextThought</p>
            <p class="subtitle">Complete your account details to get started.</p>
            <form onsubmit="return false;" id="submit_form" tal:attributes="action url" method="POST">
                <input type="text" id="name" name="name" placeholder="Full Name" required/>
                <input type="text" id="email" name="email" placeholder="Email" required/>
                <input type="checkbox" id="consent" required>By signing up you agree to the <a href="#">terms and
                    conditions</a>.</input>
                <button type="submit" class="btnCustom" onclick="submitForm();">Create An Account</button>
                <div class="success" style="display:none;"></div>
                <div class="error" style="display:none;"></div>
            </form>
            <div style="text-align:center;">
                <a href="#">Already have a Trial Site?</a>
            </div>
        </div>
    </div>

<script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous"></script>
<script src="/static/js/base.js"></script>
<script>
    function submitForm() {
        var name = $('#name').val().trim();
        var email = $('#email').val().trim();
        var consent = $('#consent').prop('checked');
        if(!name || !email || consent!==true) {
            return;
        }
        var form = $('#submit_form');
        var url = $(form).attr("action");
        var data = $(form).serialize();
        $.ajax({
            url : url,
            type: 'POST',
            data : data,
            success: function (result) {
                var redirect_uri = result['redirect_uri'];
                window.location.href = redirect_uri;
            },
            error: function (xhr, exception) {
                var result = JSON.parse(xhr.responseText);
                showErrorMessage(result['message'], '.success', '.error');
            }
        });
    }

    function getUrlParameter(name) {
        var sPageURL = window.location.search.substring(1),
            sURLVariables = sPageURL.split('&'),
            sParameterName,
            i;

        for (i = 0; i < sURLVariables.length; i++) {
            sParameterName = sURLVariables[i].split('=');

            if (sParameterName[0] === name) {
                return sParameterName[1] === undefined ? '' : decodeURIComponent(sParameterName[1]);
            }
        }
    };

    $(document).ready(function() {
        var name = getUrlParameter('name');
        var email = getUrlParameter('email');
        if (name && email){
            document.getElementById('name').value = name;
            document.getElementById('email').value = email;
            document.getElementById('consent').checked = 'checked';
            submitForm();
        }
    });

</script>
</body>
</html>